<!DOCTYPE html>
<html lang="en">
<head>
  <title>three.js webgl - trackball controls</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title></title>
  <style>
    body {
      background: #000;
      color: #fff;
      padding: 0;
      margin: 0;
      font-weight: bold;
      overflow: hidden;
    }
  </style>
</head>
<body>
<div id="container"></div>

<script src="../build/three.js"></script>
<script src="../examples/js/controls/TrackballControls.js"></script>
<script src="../examples/js/Detector.js"></script>

<script>
  if (!Detector.webgl) Detector.addGetWebGLMessage();
  var camera, scene, renderer, mesh, controls;
  init();
  animate();
  function initScene() {
    scene = new THREE.Scene();
  }
  function initRenderer() {
    renderer = new THREE.WebGLRenderer({antialias: true});
//    renderer = new THREE.WebGLRenderer({antialias: false});
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    container = document.getElementById('container');
    container.appendChild(renderer.domElement);
  }
  function initMeshBackground(){
    var geometry = new THREE.PlaneGeometry( 50, 90);
//    var material = new THREE.MeshBasicMaterial( {color: 0xffff00, side: THREE.DoubleSide} );
    var material = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('../examples/testdata/clouds.jpg') } );
    material.side = THREE.DoubleSide;
//    var meshFaceMaterial = new THREE.MeshFaceMaterial([material,material]);
    var plane = new THREE.Mesh( geometry, material );

    plane.rotation.x=-Math.PI/2;
    scene.add( plane );
  }
  function initMesh() {
    var geometry = new THREE.CubeGeometry(20, 20, 20);
    var picFilePrefix = '../examples/testdata/';
    var pics = ['crate.jpg', 'bricks.jpg', 'clouds.jpg', 'stone-wall.jpg', 'water.jpg', 'wood-floor.jpg'];
    var materials = [];
    for (var i = 0; i < pics.length; i++) {
      var mm = new THREE.MeshPhongMaterial({map: THREE.ImageUtils.loadTexture(picFilePrefix + pics[i])});
      if (i == 3)mm = null;
      materials.push(mm);
    }
    var meshFaceMaterial = new THREE.MeshFaceMaterial(materials);
    mesh = new THREE.Mesh(geometry, meshFaceMaterial);
    mesh.position.y = 10;
//    mesh.position.set(10, 10, -50);
//    mesh.updateMatrix();
//    mesh.matrixAutoUpdate = false;
    scene.add(mesh);
  }
  function initCamera() {
    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
//    camera.position.z = 50;
//    camera.position.y = 30;
    camera.position.set(30, 30, 50);
  }
  function initLight() {
    var light = new THREE.DirectionalLight(0xffffff);
    light.position.set(1, 1, 1);
//    light.position.set(1, 1, 1).normalize();
    scene.add(light);
    light = new THREE.DirectionalLight(0xffffff);
    light.position.set(-1, -1, -1).normalize();
    scene.add(light);
  }
  function initControls() {
    controls = new THREE.TrackballControls(camera);
    controls.rotateSpeed = 5.0;
    controls.zoomSpeed = 1.2;
    controls.panSpeed = 0.8;
    controls.noZoom = false;
    controls.noPan = false;
    controls.staticMoving = true;
    controls.dynamicDampingFactor = 0.3;
    controls.keys = [65, 83, 68];
//    controls.addEventListener('change', render);
  }
  function init() {
    initScene();
    initCamera();
    initControls();
    initLight();
    initMesh();
    initMeshBackground();
    initRenderer();

    var gridHelper = new THREE.GridHelper(100, 100);
    scene.add(gridHelper);

    window.addEventListener('resize', onWindowResize, false);
//    render();
  }


  function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    controls.handleResize();
//    render();
  }

  function animate() {
//    mesh.rotation.x += .04;
//    mesh.rotation.y += .02;
    requestAnimationFrame(animate);
    render();
    controls.update();
  }

  function render() {
    renderer.render(scene, camera);
  }

</script>

</body>
</html>